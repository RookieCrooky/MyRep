name: Update and Convert servers.txt to Clash YAML

on:
  schedule:
    - cron: '0 0 * * *'  # –∑–∞–ø—É—Å–∫ —Ä–∞–∑ –≤ –¥–µ–Ω—å (UTC)
  workflow_dispatch:

permissions:
  contents: write  # –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∑–∞–ø–∏—Å—å

jobs:
  update-servers:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3 python3-pip
        pip install pyyaml

    - name: Download servers.txt
      run: |
        curl -L -o servers.txt https://raw.githubusercontent.com/igareck/vpn-configs-for-russia/refs/heads/main/Vless-Reality-White-Lists-Rus-Mobile.txt

    - name: Convert servers.txt ‚Üí servers.yml
      run: |
        import yaml, base64, urllib.parse, re, json, datetime
        from collections import defaultdict
        
        def clean_line(line):
            """–û—á–∏—Å—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ –æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –¥–∞—Ç –∏ –º—É—Å–æ—Ä–∞"""
            # –£–¥–∞–ª—è–µ–º –≤—Å—ë –ø–æ—Å–ª–µ # –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —á–∞—Å—Ç—å —Å—Å—ã–ª–∫–∏
            if '://' in line:
                # –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ —É–∂–µ –Ω–∞–π–¥–µ–Ω–∞, –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–±–µ–ª–∞ –ø–æ—Å–ª–µ —Å—Å—ã–ª–∫–∏
                parts = line.split()
                for part in parts:
                    if part.startswith(('vless://', 'vmess://', 'ss://', 'trojan://')):
                        return part.strip()
            
            # –£–¥–∞–ª—è–µ–º –º—É—Å–æ—Ä–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å –¥–∞—Ç–∞–º–∏ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏
            garbage_patterns = [
                r'^Date/Time:.*',
                r'^For more info.*',
                r'^https?://.*github\.com.*',
                r'^\*\*\*.*',
                r'^---.*',
                r'^===.*',
                r'^Last update:.*',
                r'^Updated:.*',
                r'^Moscow.*',
                r'^UTC.*',
            ]
            
            for pattern in garbage_patterns:
                if re.match(pattern, line, re.IGNORECASE):
                    return None
            
            # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É, –Ω–æ –µ—Å—Ç—å –º—É—Å–æ—Ä –≤–æ–∫—Ä—É–≥
            if '://' in line:
                # –ò—â–µ–º –ø–µ—Ä–≤—É—é —Å—Å—ã–ª–∫—É –≤ —Å—Ç—Ä–æ–∫–µ
                match = re.search(r'(vless|vmess|ss|trojan)://[^\s]+', line)
                if match:
                    return match.group(0)
            
            return line.strip()
        
        def decode_base64(data):
            """–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ base64 —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º padding"""
            try:
                # –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫
                data = data.replace(' ', '').replace('\n', '').replace('\r', '')
                
                missing_padding = len(data) % 4
                if missing_padding:
                    data += '=' * (4 - missing_padding)
                
                return base64.b64decode(data).decode('utf-8', errors='ignore')
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è base64: {e}")
                return None
        
        def parse_vless(uri):
            """–ü–∞—Ä—Å–∏–Ω–≥ VLESS URI"""
            try:
                # –û—á–∏—Å—Ç–∫–∞ URI - —É–¥–∞–ª—è–µ–º –≤—Å—ë –ø–æ—Å–ª–µ –ø—Ä–æ–±–µ–ª–∞ –∏–ª–∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
                uri = uri.split()[0] if ' ' in uri else uri
                uri = uri.strip()
                
                if not uri.startswith('vless://'):
                    return None
                
                # –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å
                uri = uri[8:]
                
                # –†–∞–∑–¥–µ–ª—è–µ–º UUID –∏ –æ—Å—Ç–∞–ª—å–Ω–æ–µ
                if '@' not in uri:
                    return None
                
                uuid_part, rest = uri.split('@', 1)
                uuid = uuid_part.split(':')[0] if ':' in uuid_part else uuid_part
                
                # –†–∞–∑–¥–µ–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä:–ø–æ—Ä—Ç –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                if '?' in rest:
                    server_port, params = rest.split('?', 1)
                else:
                    server_port, params = rest, ''
                
                # –û—á–∏—Å—Ç–∫–∞ –ø–æ—Ä—Ç–∞ - —É–¥–∞–ª—è–µ–º —Å–ª–µ—à–∏ –∏ –º—É—Å–æ—Ä
                server_port = server_port.strip()
                if '/' in server_port:
                    server_port = server_port.split('/')[0]
                
                if ':' not in server_port:
                    return None
                
                server, port = server_port.split(':', 1)
                server = server.strip()
                port = port.strip()
                
                # –û—á–∏—Å—Ç–∫–∞ –ø–æ—Ä—Ç–∞ –æ—Ç –º—É—Å–æ—Ä–∞
                port = re.sub(r'[^0-9]', '', port)
                if not port:
                    return None
                
                port = int(port)
                
                # –ü–∞—Ä—Å–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                params_dict = urllib.parse.parse_qs(params) if params else {}
                
                # –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–∫—Å–∏
                proxy = {
                    "name": "",
                    "type": "vless",
                    "server": server,
                    "port": port,
                    "uuid": uuid,
                    "network": params_dict.get('type', ['tcp'])[0],
                    "udp": True,
                    "skip-cert-verify": True,
                    "tls": False
                }
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ TLS
                security = params_dict.get('security', [''])[0]
                if security in ['tls', 'reality', 'xtls']:
                    proxy['tls'] = True
                    sni = params_dict.get('sni', params_dict.get('host', ['']))
                    if sni and sni[0]:
                        proxy['servername'] = sni[0]
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ WS
                if proxy['network'] == 'ws':
                    proxy['ws-opts'] = {
                        "path": params_dict.get('path', ['/'])[0],
                        "headers": {}
                    }
                    host = params_dict.get('host', params_dict.get('sni', ['']))
                    if host and host[0]:
                        proxy['ws-opts']["headers"]["Host"] = host[0]
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ gRPC
                elif proxy['network'] == 'grpc':
                    service_name = params_dict.get('serviceName', [''])[0] or params_dict.get('serviceName', [''])[0]
                    proxy['grpc-opts'] = {
                        "grpc-service-name": service_name if service_name else "grpc"
                    }
                
                return proxy
                
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ VLESS: {e} | URI: {uri[:50]}...")
                return None
        
        def parse_vmess(uri):
            """–ü–∞—Ä—Å–∏–Ω–≥ VMESS URI"""
            try:
                # –û—á–∏—Å—Ç–∫–∞ URI
                uri = uri.split()[0] if ' ' in uri else uri
                uri = uri.strip()
                
                if not uri.startswith('vmess://'):
                    return None
                
                # –î–µ–∫–æ–¥–∏—Ä—É–µ–º base64
                encoded = uri[8:]
                decoded = decode_base64(encoded)
                if not decoded:
                    return None
                
                # –ü–∞—Ä—Å–∏–º JSON
                config = json.loads(decoded)
                
                proxy = {
                    "name": config.get('ps', ''),
                    "type": "vmess",
                    "server": config.get('add', ''),
                    "port": int(config.get('port', 0)),
                    "uuid": config.get('id', ''),
                    "alterId": int(config.get('aid', 0)),
                    "cipher": config.get('scy', 'auto'),
                    "udp": True,
                    "skip-cert-verify": True,
                    "tls": False
                }
                
                # TLS
                if config.get('tls') == 'tls':
                    proxy['tls'] = True
                    proxy['servername'] = config.get('sni', config.get('host', ''))
                
                # Network type
                network = config.get('net', 'tcp')
                proxy['network'] = network
                
                # WS options
                if network == 'ws':
                    proxy['ws-opts'] = {
                        "path": config.get('path', '/'),
                        "headers": {}
                    }
                    host = config.get('host', config.get('sni', ''))
                    if host:
                        proxy['ws-opts']['headers']['Host'] = host
                
                # HTTP/2
                elif network == 'h2':
                    proxy['h2-opts'] = {
                        "path": config.get('path', '/'),
                        "host": [config.get('host', config.get('sni', ''))] if config.get('host') or config.get('sni') else []
                    }
                
                return proxy
                
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ VMESS: {e}")
                return None
        
        def parse_ss(uri):
            """–ü–∞—Ä—Å–∏–Ω–≥ Shadowsocks URI"""
            try:
                # –û—á–∏—Å—Ç–∫–∞ URI
                uri = uri.split()[0] if ' ' in uri else uri
                uri = uri.strip()
                
                if not uri.startswith('ss://'):
                    return None
                
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è –µ—Å–ª–∏ –µ—Å—Ç—å
                name = ''
                if '#' in uri:
                    uri, name_part = uri.split('#', 1)
                    name = urllib.parse.unquote(name_part)
                
                # –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å
                uri = uri[5:]
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç
                if '@' in uri:
                    # –§–æ—Ä–º–∞—Ç: method:password@server:port
                    method_password, server_port = uri.split('@', 1)
                    method, password = method_password.split(':', 1)
                    server, port = server_port.split(':', 1)
                else:
                    # Base64 —Ñ–æ—Ä–º–∞—Ç
                    decoded = decode_base64(uri)
                    if not decoded:
                        return None
                    
                    if '@' not in decoded:
                        return None
                    
                    method_password, server_port = decoded.split('@', 1)
                    method, password = method_password.split(':', 1)
                    server, port = server_port.split(':', 1)
                
                # –û—á–∏—Å—Ç–∫–∞ –ø–æ—Ä—Ç–∞
                port = re.sub(r'[^0-9]', '', port)
                if not port:
                    return None
                
                # –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —à–∏—Ñ—Ä—ã
                supported_ciphers = [
                    'aes-128-gcm', 'aes-192-gcm', 'aes-256-gcm',
                    'chacha20-ietf-poly1305', 'xchacha20-ietf-poly1305',
                    'aes-128-cfb', 'aes-192-cfb', 'aes-256-cfb',
                    'rc4-md5', 'chacha20-ietf'
                ]
                
                if method.lower() not in [c.lower() for c in supported_ciphers]:
                    method = 'chacha20-ietf-poly1305'
                
                return {
                    "name": name,
                    "type": "ss",
                    "server": server.strip(),
                    "port": int(port),
                    "cipher": method,
                    "password": password,
                    "udp": True
                }
                
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ SS: {e}")
                return None
        
        def parse_trojan(uri):
            """–ü–∞—Ä—Å–∏–Ω–≥ Trojan URI"""
            try:
                # –û—á–∏—Å—Ç–∫–∞ URI
                uri = uri.split()[0] if ' ' in uri else uri
                uri = uri.strip()
                
                if not uri.startswith('trojan://'):
                    return None
                
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è –µ—Å–ª–∏ –µ—Å—Ç—å
                name = ''
                if '#' in uri:
                    uri, name_part = uri.split('#', 1)
                    name = urllib.parse.unquote(name_part)
                
                # –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å
                uri = uri[9:]
                
                # –†–∞–∑–¥–µ–ª—è–µ–º –ø–∞—Ä–æ–ª—å –∏ –æ—Å—Ç–∞–ª—å–Ω–æ–µ
                if '@' not in uri:
                    return None
                
                password, rest = uri.split('@', 1)
                
                # –†–∞–∑–¥–µ–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä:–ø–æ—Ä—Ç –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                if '?' in rest:
                    server_port, params = rest.split('?', 1)
                    params_dict = urllib.parse.parse_qs(params)
                else:
                    server_port, params_dict = rest, {}
                
                # –û—á–∏—Å—Ç–∫–∞ –ø–æ—Ä—Ç–∞
                if ':' not in server_port:
                    return None
                
                server, port = server_port.split(':', 1)
                port = re.sub(r'[^0-9]', '', port)
                if not port:
                    return None
                
                proxy = {
                    "name": name,
                    "type": "trojan",
                    "server": server.strip(),
                    "port": int(port),
                    "password": password,
                    "udp": True,
                    "skip-cert-verify": True,
                    "sni": params_dict.get('sni', [''])[0] if params_dict.get('sni') else ""
                }
                
                # Network
                network = params_dict.get('type', ['tcp'])[0]
                proxy['network'] = network
                
                # WS
                if network == 'ws':
                    proxy['ws-opts'] = {
                        "path": params_dict.get('path', ['/'])[0],
                        "headers": {}
                    }
                    host = params_dict.get('host', params_dict.get('sni', ['']))
                    if host and host[0]:
                        proxy['ws-opts']["headers"]["Host"] = host[0]
                
                return proxy
                
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Trojan: {e}")
                return None
        
        def main():
            # –ß—Ç–µ–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–∞
            with open("servers.txt", "r", encoding="utf-8") as f:
                raw_lines = f.readlines()
            
            print(f"–ü—Ä–æ—á–∏—Ç–∞–Ω–æ {len(raw_lines)} —Å—Ç—Ä–æ–∫")
            
            # –û—á–∏—Å—Ç–∫–∞ —Å—Ç—Ä–æ–∫
            clean_lines = []
            for line in raw_lines:
                line = line.strip()
                if not line:
                    continue
                
                cleaned = clean_line(line)
                if cleaned:
                    clean_lines.append(cleaned)
            
            print(f"–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –æ—Å—Ç–∞–ª–æ—Å—å {len(clean_lines)} —Å—Ç—Ä–æ–∫")
            
            # –ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–∫—Å–∏
            proxies = []
            name_counter = defaultdict(int)
            
            for i, line in enumerate(clean_lines):
                if not line or len(line) < 10:
                    continue
                
                proxy = None
                
                try:
                    if line.startswith('vless://'):
                        proxy = parse_vless(line)
                    elif line.startswith('vmess://'):
                        proxy = parse_vmess(line)
                    elif line.startswith('ss://'):
                        proxy = parse_ss(line)
                    elif line.startswith('trojan://'):
                        proxy = parse_trojan(line)
                    else:
                        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
                        continue
                except Exception as e:
                    print(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Å—Ç—Ä–æ–∫–∏ {i+1}: {e}")
                    continue
                
                if not proxy:
                    continue
                
                # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏
                name = proxy.get('name', '')
                if not name or name.isspace():
                    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞
                    server = proxy.get('server', '')
                    proxy_type = proxy.get('type', 'proxy')
                    name = f"{proxy_type}-{server[:15]}"
                
                # –û—á–∏—Å—Ç–∫–∞ –∏–º–µ–Ω–∏
                name = re.sub(r'[^\w\s\-\.]', '', name).strip()
                if not name:
                    name = f"Proxy-{i+1}"
                
                # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è
                base_name = name[:30]  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                name_counter[base_name] += 1
                if name_counter[base_name] > 1:
                    name = f"{base_name}-{name_counter[base_name]}"
                
                proxy['name'] = name
                
                # –í–∞–ª–∏–¥–∞—Ü–∏—è
                if not all(key in proxy for key in ['server', 'port', 'type']):
                    print(f"–ü—Ä–æ–ø—É—â–µ–Ω –ø—Ä–æ–∫—Å–∏ {name}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è")
                    continue
                
                if not (1 <= proxy['port'] <= 65535):
                    print(f"–ü—Ä–æ–ø—É—â–µ–Ω –ø—Ä–æ–∫—Å–∏ {name}: –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–æ—Ä—Ç {proxy['port']}")
                    continue
                
                proxies.append(proxy)
                print(f"‚úì –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–∫—Å–∏: {name}")
            
            print(f"\n–£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ {len(proxies)} –ø—Ä–æ–∫—Å–∏")
            
            if not proxies:
                print("–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –≤–∞–ª–∏–¥–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏")
                # –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫—É —á—Ç–æ–±—ã workflow –Ω–µ –ø–∞–¥–∞–ª
                config = {
                    "port": 7890,
                    "socks-port": 7891,
                    "mode": "rule",
                    "proxies": [],
                    "proxy-groups": [],
                    "rules": ["MATCH,DIRECT"]
                }
            else:
                # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Clash
                config = {
                    "port": 7890,
                    "socks-port": 7891,
                    "allow-lan": False,
                    "mode": "rule",
                    "log-level": "info",
                    "external-controller": "127.0.0.1:9090",
                    
                    "dns": {
                        "enable": True,
                        "ipv6": False,
                        "listen": "0.0.0.0:53",
                        "default-nameserver": ["8.8.8.8", "1.1.1.1"],
                        "enhanced-mode": "fake-ip",
                        "fake-ip-range": "198.18.0.1/16",
                        "nameserver": [
                            "https://doh.pub/dns-query",
                            "https://dns.alidns.com/dns-query"
                        ]
                    },
                    
                    "proxies": proxies,
                    
                    "proxy-groups": [
                        {
                            "name": "üöÄ –ê–≤—Ç–æ-–≤—ã–±–æ—Ä",
                            "type": "url-test",
                            "url": "http://www.gstatic.com/generate_204",
                            "interval": 600,
                            "tolerance": 150,
                            "timeout": 5000,
                            "proxies": [p["name"] for p in proxies]
                        },
                        {
                            "name": "üîß –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä",
                            "type": "select",
                            "proxies": ["üöÄ –ê–≤—Ç–æ-–≤—ã–±–æ—Ä"] + [p["name"] for p in proxies]
                        },
                        {
                            "name": "üìä –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞",
                            "type": "load-balance",
                            "url": "http://www.gstatic.com/generate_204",
                            "interval": 600,
                            "strategy": "round-robin",
                            "proxies": [p["name"] for p in proxies]
                        }
                    ],
                    
                    # –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑ GEOSITE
                    "rules": [
                        "DOMAIN-SUFFIX,openai.com,üîß –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä",
                        "DOMAIN-SUFFIX,google.com,üîß –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä",
                        "DOMAIN-SUFFIX,youtube.com,üîß –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä",
                        "DOMAIN-SUFFIX,github.com,üîß –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä",
                        "DOMAIN-SUFFIX,twitter.com,üîß –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä",
                        "DOMAIN-SUFFIX,telegram.org,DIRECT",
                        "DOMAIN-SUFFIX,t.me,DIRECT",
                        "IP-CIDR,192.168.0.0/16,DIRECT",
                        "IP-CIDR,10.0.0.0/8,DIRECT",
                        "IP-CIDR,172.16.0.0/12,DIRECT",
                        "GEOIP,CN,DIRECT",
                        "MATCH,üîß –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä"
                    ]
                }
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
            with open("servers.yml", "w", encoding="utf-8") as f:
                yaml.dump(config, f, allow_unicode=True, sort_keys=False, default_flow_style=False, indent=2)
            
            print(f"\n‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
            print(f"üìÅ –§–∞–π–ª: servers.yml")
            print(f"üîó –ü—Ä–æ–∫—Å–∏: {len(proxies)}")
            
            # –°–æ–∑–¥–∞–µ–º –ª–æ–≥
            with open("conversion.log", "w", encoding="utf-8") as f:
                f.write(f"–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: {datetime.datetime.now()}\n")
                f.write(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫: {len(clean_lines)}\n")
                f.write(f"–°–æ–∑–¥–∞–Ω–æ –ø—Ä–æ–∫—Å–∏: {len(proxies)}\n")
                f.write("\n–°–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏:\n")
                for proxy in proxies:
                    f.write(f"- {proxy['name']} ({proxy['type']}://{proxy['server']}:{proxy['port']})\n")
        
        if __name__ == "__main__":
            main()
        EOF

   
    - name: Commit and Push changes
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add servers.txt servers.yml
        git diff-index --quiet HEAD || git commit -m "Update servers.txt and generate servers.yml"
        git push  # –ü—Ä–æ—Å—Ç–æ git push, –±–µ–∑ URL
